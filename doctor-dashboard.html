<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Doctor Dashboard | MedFlowX</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/interactive.css">
    <link rel="stylesheet" href="styles/live-animations.css">
    <link rel="stylesheet" href="styles/live-chat.css">
</head>

<body>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-content">
                <div class="navbar-brand">
                    <img src="images/logo.png" alt="MedFlowX" style="height: 40px; width: auto;">
                    <span>MedFlowX</span>
                </div>
                <div class="flex items-center gap-lg">
                    <div style="text-align: right;">
                        <div id="userName" style="font-weight: 600;">Doctor Name</div>
                        <div id="userRole" style="font-size: 0.875rem; color: var(--text-secondary);">Doctor</div>
                    </div>
                    <button id="logoutBtn" class="btn btn-secondary btn-sm">Logout</button>
                </div>
            </div>
        </div>
    </nav>

    <div class="dashboard-layout">
        <aside class="sidebar">
            <nav class="sidebar-nav">
                <a href="doctor-dashboard.html" class="sidebar-item active">
                    <span style="font-size: 1.5rem;">ðŸ“Š</span>
                    <span>Dashboard</span>
                </a>
                <a href="doctor-appointments.html" class="sidebar-item">
                    <span style="font-size: 1.5rem;">ðŸ“…</span>
                    <span>Appointments</span>
                </a>
                <a href="doctor-patients.html" class="sidebar-item">
                    <span style="font-size: 1.5rem;">ðŸ§‘</span>
                    <span>Patients</span>
                </a>
            </nav>
        </aside>

        <main class="main-content">
            <div class="flex justify-between items-center" style="margin-bottom: 2rem;">
                <div>
                    <h1>Welcome back, Doctor!</h1>
                    <p style="color: var(--text-secondary); margin: 0;">Here's your schedule for today.</p>
                </div>
                <div style="color: var(--text-secondary);">
                    <span id="currentDate"></span>
                </div>
            </div>

            <!-- Stats Cards -->
            <div class="grid grid-cols-4" style="margin-bottom: 2rem;">
                <div class="card stat-card">
                    <div class="flex justify-between items-center">
                        <div>
                            <div class="stat-label">Today's Appointments</div>
                            <div class="stat-value" id="todayAppointments">8</div>
                            <div style="font-size: 0.875rem; opacity: 0.9;">3 completed</div>
                        </div>
                        <div class="stat-icon">ðŸ“…</div>
                    </div>
                </div>

                <div class="card stat-card success">
                    <div class="flex justify-between items-center">
                        <div>
                            <div class="stat-label">Total Patients</div>
                            <div class="stat-value" id="totalPatients">156</div>
                            <div style="font-size: 0.875rem; opacity: 0.9;">Active</div>
                        </div>
                        <div class="stat-icon">ðŸ§‘</div>
                    </div>
                </div>

                <div class="card stat-card warning">
                    <div class="flex justify-between items-center">
                        <div>
                            <div class="stat-label">Emergency Cases</div>
                            <div class="stat-value" id="emergencyCases">2</div>
                            <div style="font-size: 0.875rem; opacity: 0.9;">Needs attention</div>
                        </div>
                        <div class="stat-icon">ðŸš¨</div>
                    </div>
                </div>

                <div class="card stat-card info">
                    <div class="flex justify-between items-center">
                        <div>
                            <div class="stat-label">Pending Reviews</div>
                            <div class="stat-value" id="pendingReviews">5</div>
                            <div style="font-size: 0.875rem; opacity: 0.9;">Lab reports</div>
                        </div>
                        <div class="stat-icon">ðŸ“‹</div>
                    </div>
                </div>
            </div>

            <!-- Emergency Alerts -->
            <div id="emergencyAlerts" style="margin-bottom: 2rem;"></div>

            <!-- Today's Schedule -->
            <div class="card" style="margin-bottom: 2rem;">
                <div class="card-header">
                    <h3 class="card-title">Today's Schedule</h3>
                    <p class="card-subtitle">Your appointments for January 21, 2026</p>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Time</th>
                                <th>Patient</th>
                                <th>Type</th>
                                <th>Reason</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="todaySchedule">
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Quick Actions & Recent Patients -->
            <div class="grid grid-cols-2">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Quick Actions</h3>
                    </div>
                    <div style="display: flex; flex-direction: column; gap: 1rem;">
                        <a href="doctor-appointments.html" class="btn btn-primary w-full">
                            <span>ðŸ“…</span> View All Appointments
                        </a>
                        <a href="doctor-patients.html" class="btn btn-success w-full">
                            <span>ðŸ§‘</span> Patient Records
                        </a>
                        <button class="btn btn-secondary w-full"
                            onclick="NotificationManager.show('Feature coming soon!', 'info')">
                            <span>ðŸ“Š</span> View Reports
                        </button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Recent Patients</h3>
                    </div>
                    <div id="recentPatients"></div>
                </div>
            </div>
        </main>
    </div>

    <!-- Patient Record Modal -->
    <div id="patientRecordModal" class="modal-overlay hidden">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Patient Record</h3>
                <button class="modal-close" onclick="ModalManager.hide('patientRecordModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div id="patientDetails"></div>
                <form id="medicalRecordForm" style="margin-top: 1.5rem;">
                    <h4 style="margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 1px solid var(--border);">
                        Update Medical Record
                    </h4>
                    <div class="form-group">
                        <label class="form-label">Diagnosis</label>
                        <input type="text" id="diagnosis" class="form-input" placeholder="Enter diagnosis">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Prescription</label>
                        <textarea id="prescription" class="form-textarea"
                            placeholder="Enter prescription details"></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Treatment Notes</label>
                        <textarea id="notes" class="form-textarea" placeholder="Enter treatment notes"></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Next Visit Date</label>
                        <input type="date" id="nextVisit" class="form-input">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="ModalManager.hide('patientRecordModal')">Cancel</button>
                <button class="btn btn-success" onclick="saveMedicalRecord()">Save Record</button>
            </div>
        </div>
    </div>

    <script src="js/app.js"></script>
    <script src="js/live-updates.js"></script>
    <script src="js/live-chat.js"></script>
    <script>
        requireAuth('doctor');
        initCommonElements();

        // Set current date
        document.getElementById('currentDate').textContent = new Date().toLocaleDateString('en-IN', {
            weekday: 'long',
            year: 'numeric',
            month: 'long',
            day: 'numeric'
        });

        // Show emergency alerts
        const emergencyAppointments = mockData.appointments.filter(apt => apt.type === 'emergency');
        if (emergencyAppointments.length > 0) {
            document.getElementById('emergencyAlerts').innerHTML = emergencyAppointments.map(apt => `
        <div class="alert alert-error">
          <div>
            <strong>Emergency Alert!</strong>
            <p style="margin: 0.5rem 0 0 0;">
              Patient <strong>${apt.patientName}</strong> scheduled at ${apt.time} - ${apt.reason}
            </p>
          </div>
        </div>
      `).join('');
        }

        // Load today's schedule
        const todayAppointments = mockData.appointments.filter(apt => apt.date === '2026-01-21' && apt.doctorId === 'doc1');
        const tbody = document.getElementById('todaySchedule');
        tbody.innerHTML = todayAppointments.map(apt => `
      <tr>
        <td><strong>${apt.time}</strong></td>
        <td>${apt.patientName}</td>
        <td><span class="badge ${utils.getStatusBadgeClass(apt.type)}">${apt.type}</span></td>
        <td>${apt.reason}</td>
        <td><span class="badge ${utils.getStatusBadgeClass(apt.status)}">${apt.status}</span></td>
        <td>
          <button class="btn btn-sm btn-primary" onclick="viewPatientRecord('${apt.patientId}')">View</button>
          ${apt.status === 'scheduled' ?
                `<button class="btn btn-sm btn-success" onclick="completeAppointment('${apt.id}')">Complete</button>` :
                ''
            }
        </td>
      </tr>
    `).join('');

        // Load recent patients
        const recentPatients = mockData.patients.slice(0, 3);
        document.getElementById('recentPatients').innerHTML = recentPatients.map(patient => `
      <div style="padding: 1rem; border-bottom: 1px solid var(--border); cursor: pointer;" 
           onclick="viewPatientRecord('${patient.id}')">
        <div style="font-weight: 600;">${patient.name}</div>
        <div style="font-size: 0.875rem; color: var(--text-secondary); margin-top: 0.25rem;">
          ${patient.age} years â€¢ ${patient.condition}
        </div>
        <div style="font-size: 0.75rem; color: var(--text-secondary); margin-top: 0.25rem;">
          Last visit: ${utils.formatDate(patient.lastVisit)}
        </div>
      </div>
    `).join('');

        function viewPatientRecord(patientId) {
            const patient = mockData.patients.find(p => p.id === patientId);
            if (patient) {
                document.getElementById('patientDetails').innerHTML = `
          <div class="card" style="background: var(--gray-50); margin-bottom: 1rem;">
            <h4 style="margin-bottom: 1rem;">${patient.name}</h4>
            <div class="grid grid-cols-2" style="gap: 0.5rem; font-size: 0.875rem;">
              <div><strong>Age:</strong> ${patient.age} years</div>
              <div><strong>Gender:</strong> ${patient.gender}</div>
              <div><strong>Blood Group:</strong> ${patient.bloodGroup}</div>
              <div><strong>Phone:</strong> ${patient.phone}</div>
              <div style="grid-column: 1 / -1;"><strong>Address:</strong> ${patient.address}</div>
              <div style="grid-column: 1 / -1;"><strong>Current Condition:</strong> ${patient.condition}</div>
            </div>
          </div>
        `;
                ModalManager.show('patientRecordModal');
            }
        }

        function saveMedicalRecord() {
            const diagnosis = document.getElementById('diagnosis').value;
            const prescription = document.getElementById('prescription').value;
            const notes = document.getElementById('notes').value;

            if (diagnosis && prescription) {
                NotificationManager.show('Medical record saved successfully!', 'success');
                ModalManager.hide('patientRecordModal');
                document.getElementById('medicalRecordForm').reset();
            } else {
                NotificationManager.show('Please fill in diagnosis and prescription', 'warning');
            }
        }

        function completeAppointment(aptId) {
            NotificationManager.show('Appointment marked as completed', 'success');
            // Reload appointments
            location.reload();
        }
    </script>
</body>

</html>