<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Departments & Rooms | Admin</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/interactive.css">
</head>

<body>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-content">
                <div class="navbar-brand">
                    <img src="images/logo.png" alt="MedFlowX" style="height: 40px; width: auto;">
                    <span>MedFlowX</span>
                </div>
                <div class="flex items-center gap-lg">
                    <div style="text-align: right;">
                        <div id="userName" style="font-weight: 600;">Admin Name</div>
                        <div id="userRole" style="font-size: 0.875rem; color: var(--text-secondary);">Admin</div>
                    </div>
                    <button id="logoutBtn" class="btn btn-secondary btn-sm">Logout</button>
                </div>
            </div>
        </div>
    </nav>

    <div class="dashboard-layout">
        <aside class="sidebar">
            <nav class="sidebar-nav">
                <a href="admin-dashboard.html" class="sidebar-item">
                    <span style="font-size: 1.5rem;">üìä</span>
                    <span>Dashboard</span>
                </a>
                <a href="admin-doctors.html" class="sidebar-item">
                    <span style="font-size: 1.5rem;">üë®‚Äç‚öïÔ∏è</span>
                    <span>Doctors</span>
                </a>
                <a href="admin-departments.html" class="sidebar-item active">
                    <span style="font-size: 1.5rem;">üè¢</span>
                    <span>Departments</span>
                </a>
                <a href="admin-billing.html" class="sidebar-item">
                    <span style="font-size: 1.5rem;">üí∞</span>
                    <span>Billing</span>
                </a>
            </nav>
        </aside>

        <main class="main-content">
            <div class="flex justify-between items-center" style="margin-bottom: 2rem;">
                <div>
                    <h1>Departments & Room Management</h1>
                    <p style="color: var(--text-secondary); margin: 0;">Manage hospital departments and room allocation
                    </p>
                </div>
                <button class="btn btn-primary" onclick="ModalManager.show('addDepartmentModal')">
                    <span>‚ûï</span> Add Department
                </button>
            </div>

            <!-- Overview Stats -->
            <div class="grid grid-cols-3" style="margin-bottom: 2rem;">
                <div class="card" style="position: relative; overflow: hidden;">
                    <img src="https://images.unsplash.com/photo-1519494026892-80bbd2d6fd0d?auto=format&fit=crop&q=80&w=400"
                        alt="Departments"
                        style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; opacity: 0.15;">
                    <div style="position: relative; z-index: 1;">
                        <h4 style="color: var(--text-secondary); font-size: 0.875rem; margin-bottom: 0.5rem;">Total
                            Departments</h4>
                        <div style="font-size: 2.5rem; font-weight: 800; color: var(--primary-blue);"
                            id="totalDepartments">5</div>
                    </div>
                </div>
                <div class="card" style="position: relative; overflow: hidden;">
                    <img src="https://images.unsplash.com/photo-1586773860418-d37222d8fce3?auto=format&fit=crop&q=80&w=400"
                        alt="Rooms"
                        style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; opacity: 0.15;">
                    <div style="position: relative; z-index: 1;">
                        <h4 style="color: var(--text-secondary); font-size: 0.875rem; margin-bottom: 0.5rem;">Total
                            Rooms</h4>
                        <div style="font-size: 2.5rem; font-weight: 800; color: var(--secondary-green);"
                            id="totalRooms">65</div>
                    </div>
                </div>
                <div class="card" style="position: relative; overflow: hidden;">
                    <img src="https://images.unsplash.com/photo-1631815588090-d4bfec5b1ccb?auto=format&fit=crop&q=80&w=400"
                        alt="Occupied"
                        style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; opacity: 0.15;">
                    <div style="position: relative; z-index: 1;">
                        <h4 style="color: var(--text-secondary); font-size: 0.875rem; margin-bottom: 0.5rem;">Occupied
                            Rooms</h4>
                        <div style="font-size: 2.5rem; font-weight: 800; color: var(--warning);" id="occupiedRooms">48
                        </div>
                    </div>
                </div>
            </div>

            <!-- Departments List -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">All Departments</h3>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Department</th>
                                <th>Department Head</th>
                                <th>Total Rooms</th>
                                <th>Occupied</th>
                                <th>Available</th>
                                <th>Occupancy Rate</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="departmentsTable">
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <!-- Add Department Modal -->
    <div id="addDepartmentModal" class="modal-overlay hidden">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Add New Department</h3>
                <button class="modal-close" onclick="ModalManager.hide('addDepartmentModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="departmentForm">
                    <div class="form-group">
                        <label class="form-label">Department Name *</label>
                        <input type="text" id="deptName" class="form-input" placeholder="Enter department name"
                            required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Department Head *</label>
                        <input type="text" id="deptHead" class="form-input" placeholder="Enter head of department"
                            required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Number of Rooms *</label>
                        <input type="number" id="deptRooms" class="form-input" placeholder="Enter number of rooms"
                            required min="1">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Currently Occupied</label>
                        <input type="number" id="deptOccupied" class="form-input" placeholder="Enter occupied rooms"
                            value="0" min="0">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="ModalManager.hide('addDepartmentModal')">Cancel</button>
                <button class="btn btn-success" onclick="handleSaveDepartment()">Save Department</button>
            </div>
        </div>
    </div>

    <script src="js/app.js"></script>
    <script>
        requireAuth('admin');
        initCommonElements();

        let departments = [...mockData.departments];

        function calculateStats() {
            const totalDepts = departments.length;
            const totalRooms = departments.reduce((sum, dept) => sum + dept.rooms, 0);
            const occupiedRooms = departments.reduce((sum, dept) => sum + dept.occupied, 0);

            document.getElementById('totalDepartments').textContent = totalDepts;
            document.getElementById('totalRooms').textContent = totalRooms;
            document.getElementById('occupiedRooms').textContent = occupiedRooms;
        }

        function renderDepartments() {
            const tbody = document.getElementById('departmentsTable');
            tbody.innerHTML = departments.map(dept => {
                const available = dept.rooms - dept.occupied;
                const occupancyRate = Math.round((dept.occupied / dept.rooms) * 100);
                const occupancyClass = occupancyRate > 80 ? 'badge-error' : occupancyRate > 60 ? 'badge-warning' : 'badge-success';

                return `
          <tr>
            <td><strong>${dept.name}</strong></td>
            <td>${dept.head}</td>
            <td>${dept.rooms}</td>
            <td>${dept.occupied}</td>
            <td>${available}</td>
            <td><span class="badge ${occupancyClass}">${occupancyRate}%</span></td>
            <td>
              <button class="btn btn-sm btn-secondary" onclick="editDepartment('${dept.id}')">Edit</button>
              <button class="btn btn-sm btn-danger" onclick="deleteDepartment('${dept.id}')">Delete</button>
            </td>
          </tr>
        `;
            }).join('');
        }

        function handleSaveDepartment() {
            const newDept = {
                id: 'dept' + (departments.length + 1),
                name: document.getElementById('deptName').value,
                head: document.getElementById('deptHead').value,
                rooms: parseInt(document.getElementById('deptRooms').value),
                occupied: parseInt(document.getElementById('deptOccupied').value) || 0
            };

            departments.push(newDept);
            calculateStats();
            renderDepartments();

            NotificationManager.show(`${newDept.name} department added successfully!`, 'success');
            ModalManager.hide('addDepartmentModal');
            document.getElementById('departmentForm').reset();
        }

        function editDepartment(id) {
            const dept = departments.find(d => d.id === id);
            if (dept) {
                document.getElementById('deptName').value = dept.name;
                document.getElementById('deptHead').value = dept.head;
                document.getElementById('deptRooms').value = dept.rooms;
                document.getElementById('deptOccupied').value = dept.occupied;
                ModalManager.show('addDepartmentModal');
            }
        }

        function deleteDepartment(id) {
            if (confirm('Are you sure you want to delete this department?')) {
                departments = departments.filter(d => d.id !== id);
                calculateStats();
                renderDepartments();
                NotificationManager.show('Department deleted successfully', 'info');
            }
        }

        // Initial render
        calculateStats();
        renderDepartments();
    </script>
</body>

</html>